# Maintainer: Tristan Ross <spaceboyross@yandex.com>

pkgname=rxinitfs
pkgver=0.1.2
pkgrel=4
pkgdesc="The initramfs package for RonixOS"
url="https://github.com/ronixos/rxinitfs"
arch=("any")
license=("GPL-3.0")
groups=("base")
depends=("sh" "cpio")
source=("git+https://github.com/ronixos/rxinitfs#tag=v$pkgver" "9864ffd.diff")
sha256sums=('SKIP' '01bf16d9b6dced206590c8519f461d8ddf4fcf7c725e2eecf571bd8e2be49e87')
backup=('etc/rxinitfs.conf')

build() {
  cd "$srcdir/$pkgname"
  patch -p1 < ../9864ffd.diff
  mkdir -p template/{bin,dev,lib/modules,newroot,proc,sbin,sys}
  make PREFIX=$pkgdir/usr SYSCONFDIR=/etc
  sed -i "s|$pkgdir/|/|g" out/rxinitfs
}

package() {
  cd "$srcdir/$pkgname"
  make PREFIX=$pkgdir/usr SYSCONFDIR=$pkgdir/etc install
}
